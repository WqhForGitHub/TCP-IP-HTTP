### 1. 数据链路的作用

* 众所周知，计算机以二进制 0、1 来表示信息，然而实际的通信媒介之间处理的却是 **`电压的高低、光的闪灭以及电波的强弱`** 等信号。把这些信号与二进制的 0、1 进行转换正是物理层的责任。数据链路层处理的数据也不是单纯的 0、1 序列，该层把它们集合为一个叫做 **`帧`** 的块，然后再进行传输。

* **`数据链路`** 也可以被视为网络传输中的最小单位。





### 2. 数据链路相关技术



#### 2.1 MAC 地址

MAC 地址用于识别数据链路中互连的节点。

MAC 地址长 **`48`** 比特，在使用网卡（NIC）的情况下，MAC 地址一般会被烧入到 ROM 中。因此，任何一个网卡的 MAC 地址都是唯一的，在全世界都不会有重复。

![](https://github.com/WqhForGitHub/TCP-IP-HTTP/blob/%E5%9B%BE%E8%A7%A3TCP/IP/static/Chapter3/MAC%20address.png?raw=true)

第 1 位：单播地址（0）/ 多播地址（1）

第 2 位：全局地址（0）/ 本地地址（1）

第 3 ~ 24 位：由 IEEE 管理并保证各厂家之间不重复

第 25 ~ 48 位：由厂商管理并保证产品之间不重复



MAC 地址一般用 **`十六进制数`** 表示。例如：用十六进制多播 MAC 地址表示：

01:00:XX:XX:XX:XX

二进制 0000 0001 0000 0000

流过网络的比特流顺序：1000 0000 0000 0000



#### 2.2 共享介质型网络

从通信介质（通信，介质）的使用方法上看，网络可分为 **`共享介质型`** 和 **`非共享介质型`**。

共享介质型网络指由多个设备共享一个通信介质的一种网络。最早的以太网和 FDDI 就是介质共享性网络。在这种方式下，设备之间使用同一个载波信道进行发送和接收。为此，基本上采用半双工通信方式，并有必要对介质进行访问控制。

共享介质型网络中有两种介质访问控制方式：一种是 **`争用方式`**，另一种是 **`令牌传递方式`**。        

1. **`争用方式`**

​	争用方式是指争夺获取数据传输的权力，也叫 **`CSMA`**（**`载波监听多路访问`**）

2. **`令牌传递方式`**



#### 2.3 非共享介质网络

在这种方式下，网络中的每个站直连 **`交换机`**，由交换机负责转发数据帧。因此很多情况下采用 **`全双工通信方式`**。缺点就是一旦交换机发生故障，与之相连的所有计算机之间都将无法通信。



1. **`半双工通信`**

半双工是指，**`只发送或只接收的通信方式`**。它类似于 **`无线电收发器`**，若两端同时说话，是听不见对方说的话的。而全双工不同，**`它允许在同一时间既可以发送数据也可以接收数据`**。类似于电话，接打双方可以同时说话。

**`CSMA/CD` 方式的以太网**，首先要判断是否可以通信，如果可以就独占通信介质发送数据。因此，它像无线电收发器一样，不能同时接收和发送数据。

2. **`全双工通信`**

在使用 **`交换机与双绞线电缆`** 的情况下，既可以通过交换机的端口与计算机之间进行一对一的连接，也可以通过相连 **`电缆内部的首发线路`** 分别进行接收和发送数据。因此，交换机的端口与计算机之间可以实现同时收发的全双工通信。



#### 2.4 根据 MAC 地址转发

**`以太网交换机`**就是持有**`多个端口的网桥`**。它们根据数据链路层中每个帧的目标 MAC 地址，决定从哪个网络接口发送数据。这时所参考的、用以记录发送接口的表就叫做**`转发表`**。这种转发表可以**`自动生成`**。



* **`交换机的转发方式`**

一种叫 **`存储转发`**，另一种叫 **`直通转发`**。

**`存储转发`** 方式检查以太网数据帧末尾的 FCS 位后再进行转发。因此，可以避免发送由于冲突而被破坏的帧或噪声导致的错误帧。

 **`直通转发`** 方式中不需要将整个帧全部接收下来以后再进行转发。只需要得知目标地址即可开始转发。因此，它具有延迟较短的优势。但同时也不可避免地有发送错误帧的可能性。



#### 2.5 环路检测技术

最坏的情况在环路中被一而再再而三地持续转发，而一旦这种数据帧越积越多将会导致网络瘫痪。

1. **`生成树方式`**

2. **`源路由法`**



#### 2.6 VLAN

交换机按照其端口区分了多个网段



### 3. 以太网

以太网已成为最具兼容性与未来发展性的一种数据链路。



#### 3.1 以太网连接形式

1. 在以太网普及之初，一般采用多台终端使用 **`同一根同轴电缆`**的**`共享介质型连接方式`** 。
2. 而现在，随着互联设备的处理能力以及传输速度的提高，一般都采用 **`终端与交换机之间独占电缆的方式`** 实现以太网通信。



#### 3.2 以太网的分类



#### 3.3 以太网的历史



#### 3.4 以太网帧格式

以太网帧前端有一个叫做 **`前导码`** 的部分，它由 0、1 数字交替组合而成，表示一个以太网帧的开始，也是对端网卡能够确保与其同步的标志。前导码末尾是一个叫做 **`SFD`** 的域，它的值是 11。在这个域之后就是以太网帧的本体。前导码与 SFD 合起来占 **`8`** 个字节。

![](https://github.com/WqhForGitHub/TCP-IP-HTTP/blob/%E5%9B%BE%E8%A7%A3TCP/IP/static/Chapter3/preamble.png?raw=true)

**`以太网中将最后 2 比特称为 SFD，而 IEEE802.3 中将最后 8 比特称为 SFD。`**

* **`比特（位）、字节、8位字节`**

  * **`比特（位）`**

    二进制中最小的单位。每个比特（位）的值要么是 0 要么是 1。

  * **`字节`**

    通常 8 个比特构成一个字节。本书就以 8 个比特作为 1 个字节处理。然而在某些特殊的计算机中，1 个字节有时包含 6 个比特、7 个比特或 9 个比特。

  * **`8 位字节`**

    8 个比特也被称为 8 位字节。只有为了强调 1 个字节包含 8 个比特时才会使用。



以太网帧本体的前端是以太网的首部，它总共占 **`14`** 个字节。分别是 6 个字节的目标 MAC 地址、6 个字节的源 MAC 地址以及 2 个字节的上层协议类型。紧随帧头后面的是数据。一个数据帧所能容纳的最大数据范围是 46 ~ 1500 个字节。帧尾是一个叫做 FCS（帧检验序列）的 4 个字节。在目标 MAC 地址中存放了目标工作站的物理地址。源 MAC 地址中则存放构造以太网帧的发送端工作站的物理地址。

![](https://github.com/WqhForGitHub/TCP-IP-HTTP/blob/%E5%9B%BE%E8%A7%A3TCP/IP/static/Chapter3/ethernetframeformat.png?raw=true)

类型通常跟数据一起传送，它包含用以 **`标识协议类型`** 的编号，即表明以太网的 **`再上一层网络协议的类型`**。在这个字段的后面，则是该类型所标识的协议首部及其数据。关于主要的协议类型请参考表 3.2。

| 类型编号（16 进制） | 协议                                           |
| ------------------- | ---------------------------------------------- |
| 0000 - 05DC         | IEEE802.3 Length Field（01500）                |
| 0101 - 01FF         | 实验用                                         |
| 0800                | Internet IP（IPv4）                            |
| 0806                | Address Resolution Protocol（ARP）             |
| 8035                | Reverse Address Resolution Protocol（RARP）    |
| 8037                | IPX（Novell NetWare）                          |
| 805B                | VMTP（Versatile Message Transaction Protocol） |
| 809B                | AppleTalk（EtherTalk）                         |
| 80F3                | AppleTalk Address Resolution Protocol（AARP）  |
| 8100                | IEEE802.1Q Customer VLAN                       |
| 814C                | SNMP over Ethernet                             |
| 8191                | NetBIOS/NetBEUI                                |
| 817D                | XTP                                            |
| 86DD                | IP version 6（IPV6）                           |
| 8847-8848           | MPLS（Multi-protocol Label Switching）         |
| 8863                | PPPoE Discovery Stage                          |
| 8864                | PPPoE Session Stage                            |
| 9000                | Loopback（Configuration Test Protocol）        |

 帧尾最后出现的是 FCS。用它可以 **`检查帧是否有所损坏`**。在通信传输过程中如果出现电子噪声的干扰，可能会影响发送数据导致乱码位的出现。因此，通过检查这个 FCS 字段的值可以将那些受到干扰的错误帧丢弃。

数据链路层分为两层：
1. 介质访问控制层：根据以太网或 FDDI 等不同数据链路 **`所特有的首部信息`** 进行控制。
2. 逻辑链路控制层：根据以太网或 FDDI 等不同数据链路 **`共有的帧头信息`** 进行控制。 
在 IEEE802.3 Ethernet 中紧随着以太网首部的 **`LLC/SNAP`** 字段中包含了上层协议类型信息。因此只有查找到 **`SNAP`** 以后才能继而判断上层协议的类型。                                                                                                                           


### 4. 无线通信
#### 4.1 无线通信的种类

| 分类     | 通信距离            | 标准化组织                 | 相关其他组织及技术           |
| ------ | --------------- | --------------------- | ------------------- |
| 短距离无线  | 数米              | 个别组织                  | RF-ID               |
| 无线 PAN | 10 米左右          | IEEE802.15            | 蓝牙                  |
| 无线 LAN | 100 米左右         | IEEE802.11            | Wi-Fi               |
| 无线 MAN | 数千米 ~ 100 千米    | IEEE802.16、IEEE802.20 | WiMAX               |
| 无线 RAN | 200 千米 ~ 700 千米 | IEEE802.22            |  |
| 无线 WAN |  | GSM、CDMA2000、W-CDMA   | 3G、LTE、4G、下一代移动通信网络 |

**`PAN`** ：个人区域网络   **`LAN`** ：局域网    **`MAN`** ：城域网     **`RAN`** ：区域网络     **`WAN`** ：广域网



#### 4.2 IEEE802. 11                                                      

IEEE802. 11 在物理层上使用 **`电磁波或红外线`** 。



#### 4.7 蓝牙

蓝牙与 IEEE802. 11b/g 类似，是使用 **`2.4 GHz 频率`** 无线电波的一种标准。                                            



#### 4.8 WiMAX

WiMAX 是使用 **`微波在企业或家庭`** 实现无线通信的一种方式。



#### 4.9 ZigBee

ZigBee 主要应用于 **`家电的远程控制`** ，是一种短距离、低功耗的无线通信技巧。它最多允许 **`65536`** 个终端之间互联通信。



### 5. PPP

#### 5.1 PPP 定义

PPP 是指点对点，即 1 对 1 连接计算机的协议。PPP 相当于位于 OSI 参考模型第 2 层的数据链路层。

PPP 属于纯粹的数据链路层，与物理层没有任何关系。换句话说，仅有 PPP 无法实现通信，还需要物理层的支持。

PPP 可以使用电话线或 ISBN、专线、ATM 线路。



#### 5.2 LCP 与 NCP



#### 5.3 PPP 的帧格式

![](https://github.com/WqhForGitHub/TCP-IP-HTTP/blob/%E5%9B%BE%E8%A7%A3TCP/IP/static/Chapter3/PPP.png?raw=true)

#### 5.4 PPPoE

![](https://github.com/WqhForGitHub/TCP-IP-HTTP/blob/%E5%9B%BE%E8%A7%A3TCP/IP/static/Chapter3/PPPoE.png?raw=true)



### 6. 其他数据链路

| 数据链                                                                                                 路名称 | 介质传输速率                         | 用途                 |
| ------------------------------------------------------------ | ------------------------------------ | -------------------- |
| 以太网                                                       | 10 Mbps ~ 1000 Gbps                  | LAN、MAN             |
| 802.11                                                       | 5.5 Mbps ~ 150 Mbps                  | LAN                  |
| Bluetooth                                                    | 上限 2.1 Mbpsm，下限 177.1 kbps      | LAN                  |
| ATM                                                          | 25 Mbps、155 Mbps、622 Mbps、2.4 GHz | LAN ~ WAN            |
| POS                                                          | 51.84 Mbps ~ 约 40Gbps               | WAN                  |
| FDDI                                                         | 100 Mbps                             | LAN、MAN             |
| Token Ring                                                   | 4 Mbps、16 Mbps                      | LAN                  |
| 100 VG ~ AnyLAN                                              | 100 Mbps                             | LAN                  |
| 光纤通道                                                     | 133 Mbps ~ 4Gbps                     | SAN                  |
| HIPPI                                                        | 800 Mbps、1.6 Gbps                   | 两台计算机之间的连接 |
| IEEE1394                                                     | 100 Mbps ~ 800 Mbps                  | 面向家庭             |



### 7. 公共网络

​                                                                                                                      
