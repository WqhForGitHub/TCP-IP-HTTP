### 4.1 IP 即网际协议

#### 1. IP 相当于 OSI 参考模型的第 3 层

网络层的主要作用是实现终端节点之间的通信。这种终端节点之间的通信也叫点对点通信。

从前面的章节可知，网络层的下一层，**`数据链路层的主要作用在互联同一种数据链路的节点之间进行包传递`** 。而一旦跨越多种数据链路，就需要借助网络层。网络层可以 **`跨越不同的数据链路`** ，即使在不同的数据链路中也能实现两端节点之间的数据包传输。

* **`主机与节点`**

  在互联网世界中，将那些配有 **`IP 地址的设备叫做主机`** 。这里的主机，可以是超大型计算机，也可以是小型计算机。这是因为互联网在当初刚发明的时候，只能连接这类大型的设备，因此习惯上就将配有 IP 地址的设备称为主机。

  然而，准确的说，**`主机的定义应该是指配置有 IP 地址，但是不进行路由控制的设备`** 。**`既配有 IP 地址又具有路由控制能力的设备叫做路由器`** ，跟主机有所区别。而 **`节点则是主机和路由器的统称`** 。



### 4.2 IP 基础知识

#### 1. IP 地址属于网络层地址

IP 地址用于在 **`连接到网络中的所有主机中识别出进行通信的目标地址`** 。因此，在 TCP/IP 通信中所有 **`主机或路由器`** 必须设定自己的 IP 地址。

不论一台主机与哪种数据链路连接，其 IP 地址的形式都保持不变。以太网、无线局域网、PPP 等，都不会改变 IP 地址的形式。

另外，在 **`网桥或交换集线器`** 等物理层或数据链路层数据包转发设备中，不需要设置 IP 地址。因为这些设备只负责将 IP 包转化为 0、1 比特流转发或对数据链路帧的数据部分进行转发，而不需要应对 IP 协议。



#### 2. 路由控制

* **`发送数据至最终目标地址`** 

​	跳，它是指 **`网络中的一个区间`** 。IP包正是在网络中一个个跳间被转发。因此 IP 路由也叫做 **`多跳路由`** 。在每一个区间内决定着包在 **`下一跳被转发的路径`** 。

* **`一跳的范围`**

  一跳是指利用  **`数据链路层以下分层的功能传输数据帧的一个区间`** 。以太网等数据链路中使用 MAC 地址传输数据帧。此时的一跳是指从源 MAC 地址到目标 MAC 地址之间传输帧的区间。也就是说它是主机或路由器网卡不经其他路由器而能直接到达的相邻主机或路由器网卡之间的一个区间。在一跳的这个区间内，电缆可以通过网桥或交换集线器相连，不会通过路由器或网关相连。

* **`多跳路由`**

  多跳路由是指  **`路由器或主机在转发 IP 数据包时只指定下一个路由器或主机`** ，而不是将到最终目标地址为止的所有通路全都指定出来。因为每一个区间（跳）在转发 IP 数据包时会分别指定  **`下一跳的操作`** ，直至包达到最终的目标地址。              

* **`路由控制表`**

  为了将数据包发给目标主机，**`所有主机都维护着一张路由控制表`** 。该表记录 **`IP 数据在下一步应该发给哪个路由器`** 。IP 包将根据这个路由表在各个数据链路上传输。



#### 3. 数据链路的抽象化

不同数据链路有个最大的区别，就是它们各自的 **`最大传输单位（MTU）`** 不同。就好像人们在邮寄包裹或行李时有各自的大小限制一样。

MTU 的值在 **`以太网中是 1500 字节，在 FDDI 中是 4352 字节，而 ATM 则为 9180 字节`** 。IP 的上一层可能会要求传送比这些 MTU 更多字节的数据，因此必须在线路上传送比包长还要小的 MTU。为了解决这个问题， **`IP 进行分片处理`** 。顾名思义，所谓分片处理是指， **`将较大的 IP 包分成多个较小的 IP 包`** 。分片的包   **`到了对端目标地址以后再被组合起来传给上一层`** 。即从 IP 的上层看，它完全可以忽略数据包在途中的各个数据链路上的 MTU，而只需要按照源地址发送的长度接收数据包。IP 就是以这种方式抽象化了数据链路层，使得从上层更不容易看到底层网络构造的细节。



#### 4. IP 属于面向无连接型

1. **`简化`**
2. **`提速`**

* 为了提高可靠性，上一层的 TCP  采用面向有连接型



### 4.3 IP 地址的基础知识

#### 1. IP 地址的定义

IP 地址（IPv4 地址）由 32 位正整数来表示。TCP/IP 通信要求将这样的 IP 地址分配给每一个参与通信的主机。IP 地址在计算机内部以二进制方式被处理。然而，由于人类社会并不习惯于采用二进制方式，需要采用一种特殊的标记方式。那就是将 32 位的 IP 地址以每 8 位为一组，分成 4组，每组以 "." 隔开，再将每组数转换为十进制数。下面举例说明这一方法。

10101100             00010100           00000001      00000001

10101100             00010100           00000001      00000001

172                        20                         1                      1 



将表示成 IP 地址的数字整体计算，会得出如下数值。

2^32 = 4 294 967 296

从这个计算结果可知，最多可以允许 43 亿台计算机连接到网络。

实际上，IP 地址并非是根据主机台数来配置的，而是每一台主机上的每一块网卡（NIC）都得设置 IP 地址。通常一块网卡只设置一个 IP 地址，其实每一块网卡也可以设置多个 IP 地址。此外，一台路由器通常都会配置两个以上的网卡，因此可以设置两个以上的 IP 地址。因此，让 43 亿台计算机全部连网其实是不可能的。后面将要详细介绍 IP 地址的两个组成部分（网络标识和主机标识），了解了这两个组成部分后你会发现实际能够连接到网络的计算机个数更是少了很多。









​       