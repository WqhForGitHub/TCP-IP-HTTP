                    ### 1. HTTP 的缺点

* 通信使用明文（不加密），内容可能会被窃听。
* 不验证通信双方的身份，因此有可能遭遇伪装。
* 无法证明报文的完整性，所以有可能已遭篡改。



#### 1.1 通信使用明文可能会被窃听

* TCP/IP 是可能被窃听的网络
* 加密处理防止被窃听
  * 通信的加密
  * 内容的加密



#### 1.2 不验证通信方的身份就可能遭遇伪装

* 任何人都可发起请求
* 查明对手的证书

​	证书由值得信任的第三方机构颁发，用以证明服务器和客户端是实际存在的。另外，伪造证书从技术角度来说是异常困难的一件事。所以，只要能够确认通信方（服务器或客户端）持有的证书，即可判断通信方的真实意图。



#### 1.3 无法证明报文完整性，可能已遭篡改

* 接收到的内容可能有误

​	中间人攻击：请求或响应在传输途中，遭攻击者拦截并篡改内容的攻击。

* 如何防止篡改



### 2. HTTP + 加密 + 认证 + 完整性保护 = HTTPS

#### 2.2 HTTPS 是身披 SSL 外壳的 HTTP

通常，HTTP 直接和 TCP 通信。当使用 SSL 时，则演变成先和 SSL 通信，再由 SSL 和 TCP 通信了。简言之，所谓 HTTPS，其实就是身披 SSL 协议这层外壳的 HTTP。

在采用 SSL 后，HTTP 就拥有了 HTTPS 的加密、证书和完整性保护这些功能。

SSL 是独立于 HTTP 的协议，所以不光是 HTTP 协议，其他运行在应用层的 SMTP 和 Telnet 等协议均可配合 SSL 协议使用。可以说 SSL 是当今世界上应用最为广泛的网络安全技术。

![](https://github.com/WqhForGitHub/TCP-IP-HTTP/blob/%E5%9B%BE%E8%A7%A3HTTP/static/Chapter7/HTTPS.png?raw=true)



#### 2.3 相互交换密钥的公开密钥加密技术

* 共享密钥加密的困境

​	加密和解密同用一个密钥的方式称为共享密钥加密，也被叫做对称密钥加密。以共享密钥方式加密时必须将密钥也发给对方。可究竟怎样才能安全地转交？在互联网上转发密钥时，如果通信被监听那么密钥就可会落入攻击者之手，同时也就是失去了加密的意义。另外还得设法安全地保管接收到地密钥。

* 使用两把密钥的公开密钥加密

  公开密钥加密方式很好地解决了共享密钥加密的困难。

  公开密钥加密使用一对非对称的密钥。一把叫做私有密钥，另一把叫做公开密钥。顾名思义，私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得。

  使用公开密钥加密方式，发送密文的一方使用对方的公开密钥进行加密处理，对方收到被加密的信息后，再使用自己的私有密钥进行解密。利用这种方式，不需要发送用来解密的私有密钥，也不必担心密钥被攻击者窃听而盗走。 

* HTTPS 采用混合加密机制

1. 使用公开密钥加密方式安全地交换在稍后的共享密钥加密中要使用的密钥
2. 确保交换的密钥是安全的前提下，使用共享密钥加密方式进行通信。   



#### 2.4 证明公开密钥正确性的证书

1.  服务器把自己的公开密钥登录至数字证书认证机构
2.  数字证书认证机构用自己的私有密钥向服务器的公开密码部署数字签名并颁发公钥证书。
3.  客户端拿到服务器的公钥证书后，使用数字证书认证机构的公开密钥，向数字证书认证机构验证公钥证书上的数字签名，以确认服务器的公开密钥的真实性。
4.  使用服务器的公开密钥对报文加密后发送
5.  服务器用私有密钥对报文解密



#### 2.5 HTTPS 的安全通信机制

1. 客户端通过发送 Client Hello 报文开始 SSL 通信。报文中包含客户端支持的 SSL 的指定版本、加密组件列表（所使用的加密算法及密钥长度等）。
2. 服务器可进行 SSL 通信时，会以 Server Hello 报文作为应答。和客户端一样，在报文中包含 SSL 版本以及加密组件。服务器的加密组件内容是从接收到的客户端加密组件内筛选出来的。
3. 之后服务器发送 Certificate 报文。报文中包含公开密钥证书。
4. 最后服务器发送 Server Hello Done 报文通知客户端，最初阶段的 SSL 握手协商部分结束。
5. SSL 第一次握手结束之后，客户端以 Client Key Exchange 报文作为回应。报文中包含通信加密中使用的一种被称为 Pre-master secret 的随机密码串。该报文已用步骤 3 中的公开密钥进行加密。
6. 接着客户端继续发送 Change Cipher Spec 报文。该报文会提示服务器，在此报文之后的通信会采用 Pre-master secret 密钥加密。
7. 客户端发送 Finished 报文。该报文包含连接至今全部报文的整体校验值。这次握手协商是否能够成功，要以服务器是否能够正确解密该报文作为判定标准。
8. 服务器同样发送 Change Cipher Spec 报文。
9. 服务器同样发送 Finished 报文。
10. 服务器和客户端的 Finished 报文交换完毕之后，SSL 连接就算建立完成。当然，通信会受到 SSL 的保护。从此处开始进行应用层协议的通信，即发送 HTTP 请求。
11. 应用层协议通信，即发送 HTTP 响应。
12. 最后由客户端断开连接。断开连接时，发送 close_notify 报文。上图做了一些省略，这步之后再发送 TCP FIN 报文来关闭与 TCP 的通信。



* SSL 和 TLS
* SSL 速度慢吗















